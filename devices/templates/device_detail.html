{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soil Moisture Sensor-01 - Device Details</title>
    <!-- Base styles from main dashboard -->
    <link rel="stylesheet" href="{% static 'core/css/main.css' %}">
    <link rel="shortcut icon" href="{% static 'core/img/logo.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'projects/css/project_dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'projects/css/project_overview.css' %}">
    <!-- Device detail specific styles -->
    <link rel="stylesheet" href="{% static 'devices/css/device_detail.css' %}">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-microchip"></i>
                <span class="logo-text">IoT Platform</span>
            </div>
            <button class="toggle-btn" id="toggleBtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <ul>
                <li class="nav-item">
                    <a href="index.html">
                        <i class="fas fa-th-large"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="projects.html">
                        <i class="fas fa-folder-open"></i>
                        <span class="nav-text">Projects</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a href="devices.html">
                        <i class="fas fa-server"></i>
                        <span class="nav-text">Devices</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#analytics">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-text">Analytics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#api-keys">
                        <i class="fas fa-key"></i>
                        <span class="nav-text">API Keys</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#settings">
                        <i class="fas fa-cog"></i>
                        <span class="nav-text">Settings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#profile">
                        <i class="fas fa-user-circle"></i>
                        <span class="nav-text">Profile</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <i class="fas fa-user-circle user-avatar"></i>
                <div class="user-details">
                    <span class="user-name">John Doe</span>
                    <span class="user-role">Administrator</span>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Top Bar -->
        <header class="top-bar">
            <div class="breadcrumb">
                <a href="projects.html"><i class="fas fa-folder-open"></i> Projects</a>
                <i class="fas fa-chevron-right"></i>
                <a href="project-detail.html">Agriculture IoT</a>
                <i class="fas fa-chevron-right"></i>
                <a href="devices.html">Devices</a>
                <i class="fas fa-chevron-right"></i>
                <span>Soil Moisture-01</span>
            </div>
            <div class="top-bar-actions">
                <button class="icon-btn">
                    <i class="fas fa-bell"></i>
                    <span class="badge">5</span>
                </button>
                <button class="icon-btn">
                    <i class="fas fa-envelope"></i>
                    <span class="badge">3</span>
                </button>
                <div class="user-menu">
                    <img src="https://ui-avatars.com/api/?name=John+Doe&background=667eea&color=fff" alt="User" class="user-avatar-img">
                </div>
            </div>
        </header>

        <!-- Device Detail Container -->
        <div class="device-detail-container">
            <!-- Device Header -->
            <div class="device-detail-header">
                <div class="device-header-main">
                    <div class="device-icon-large">
                        <i class="fas fa-tint"></i>
                    </div>
                    <div class="device-header-info">
                        <div class="device-status-row">
                            <h1 id="deviceName">Soil Moisture Sensor-01</h1>
                            <span class="device-status-live online">
                                <span class="status-pulse"></span>
                                Online
                            </span>
                        </div>
                        <p class="device-description" id="deviceDescription">
                            Capacitive soil moisture sensor monitoring Field 1 for irrigation optimization
                        </p>
                        <div class="device-meta-tags">
                            <span class="meta-tag">
                                <i class="fas fa-fingerprint"></i> DEV-013
                            </span>
                            <span class="meta-tag">
                                <i class="fas fa-folder"></i> Agriculture IoT
                            </span>
                            <span class="meta-tag">
                                <i class="fas fa-calendar-plus"></i> Added Oct 11, 2025
                            </span>
                            <span class="meta-tag">
                                <i class="fas fa-clock"></i> Last seen: 2 mins ago
                            </span>
                        </div>
                    </div>
                </div>
                <div class="device-header-actions">
                    <button class="btn-outline" id="editDeviceBtn">
                        <i class="fas fa-edit"></i> Edit Device
                    </button>
                    <button class="btn-primary" id="exportDeviceDataBtn">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                </div>
            </div>

            <!-- Main Layout: Content + Sidebar -->
            <div class="device-layout">
                <!-- Main Content Area -->
                <div class="device-main-content">
                    
                    <!-- Live Data Stream -->
                    <section class="content-section">
                        <div class="section-header">
                            <h2><i class="fas fa-stream"></i> Live Data Stream</h2>
                            <div class="header-actions">
                                <span class="live-indicator">
                                    <span class="pulse"></span> Live
                                </span>
                                <button class="btn-secondary btn-sm" id="pauseStreamBtn">
                                    <i class="fas fa-pause"></i> Pause
                                </button>
                            </div>
                        </div>
                        <div class="live-stream-container" id="liveStreamContainer">
                            <!-- Live data populated by JS -->
                        </div>
                    </section>

                    <!-- Real-time Charts -->
                    <section class="content-section">
                        <div class="section-header">
                            <h2><i class="fas fa-chart-area"></i> Real-time Analytics</h2>
                            <select class="time-selector" id="chartTimeRange">
                                <option value="1h">Last Hour</option>
                                <option value="24h" selected>Last 24 Hours</option>
                                <option value="7d">Last 7 Days</option>
                                <option value="30d">Last 30 Days</option>
                            </select>
                        </div>
                        <div class="device-charts-grid">
                            <!-- Moisture Level Line Chart -->
                            <div class="chart-box chart-large">
                                <h3>Soil Moisture Level (%)</h3>
                                <canvas id="moistureChart"></canvas>
                            </div>

                            <!-- Current Reading Gauge -->
                            <div class="chart-box gauge-box">
                                <h3>Current Reading</h3>
                                <div class="gauge-container">
                                    <canvas id="currentGauge"></canvas>
                                    <div class="gauge-value" id="gaugeValue">45%</div>
                                </div>
                                <div class="gauge-status">Optimal</div>
                            </div>

                            <!-- Distribution Histogram -->
                            <div class="chart-box">
                                <h3>Reading Distribution</h3>
                                <canvas id="distributionChart"></canvas>
                            </div>

                            <!-- Trend Analysis -->
                            <div class="chart-box">
                                <h3>24-Hour Trend</h3>
                                <canvas id="trendChart"></canvas>
                            </div>
                        </div>
                    </section>

                    <!-- AI Analysis -->
                    <section class="content-section">
                        <div class="section-header">
                            <h2><i class="fas fa-brain"></i> AI Analysis & Insights</h2>
                            <span class="badge-premium">
                                <i class="fas fa-crown"></i> Premium
                            </span>
                        </div>
                        <div class="ai-insights-grid" id="aiInsightsGrid">
                            <!-- AI insights populated by JS -->
                        </div>
                    </section>

                    <!-- Scheduled Actions -->
                    <section class="content-section">
                        <div class="section-header">
                            <h2><i class="fas fa-clock"></i> Scheduled Actions</h2>
                            <button class="btn-primary btn-sm" id="addDeviceScheduleBtn">
                                <i class="fas fa-plus"></i> Add Action
                            </button>
                        </div>
                        <div class="device-schedules-container" id="deviceSchedulesContainer">
                            <!-- Schedules populated by JS -->
                        </div>
                    </section>

                    <!-- Action History -->
                    <section class="content-section">
                        <div class="section-header">
                            <h2><i class="fas fa-history"></i> Action History</h2>
                            <div class="header-actions">
                                <button class="btn-secondary btn-sm">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                                <button class="btn-secondary btn-sm">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>
                        <div class="device-history-timeline" id="deviceHistoryTimeline">
                            <!-- History populated by JS -->
                        </div>
                    </section>

                    <!-- Device Settings -->
                    <section class="content-section">
                        <div class="section-header">
                            <h2><i class="fas fa-cog"></i> Device Settings</h2>
                        </div>
                        <div class="device-settings-grid">
                            <div class="settings-group">
                                <h3><i class="fas fa-sliders-h"></i> Configuration</h3>
                                <div class="settings-list" id="deviceConfigList">
                                    <!-- Configuration items populated by JS -->
                                </div>
                            </div>
                            <div class="settings-group">
                                <h3><i class="fas fa-bell"></i> Alerts & Thresholds</h3>
                                <div class="settings-list" id="deviceAlertsConfig">
                                    <!-- Alert configurations populated by JS -->
                                </div>
                            </div>
                            <div class="settings-group danger-zone">
                                <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
                                <div class="danger-actions">
                                    <button class="btn-danger-outline" id="resetDeviceBtn">
                                        <i class="fas fa-redo"></i> Reset Device
                                    </button>
                                    <button class="btn-danger" id="deleteDeviceBtn">
                                        <i class="fas fa-trash"></i> Delete Device
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>

                </div>

                <!-- Right Sidebar: Device Info -->
                <aside class="device-sidebar">
                    <!-- Project Info -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-header">
                            <h3><i class="fas fa-folder"></i> Project</h3>
                        </div>
                        <div class="project-link-card" id="projectLinkCard">
                            <!-- Project info populated by JS -->
                        </div>
                    </div>

                    <!-- Connected Sensors -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-header">
                            <h3><i class="fas fa-satellite-dish"></i> Sensors</h3>
                        </div>
                        <div class="sensors-list" id="sensorsList">
                            <!-- Sensors populated by JS -->
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-header">
                            <h3><i class="fas fa-chart-bar"></i> Statistics</h3>
                        </div>
                        <div class="quick-stats" id="quickStats">
                            <!-- Stats populated by JS -->
                        </div>
                    </div>

                    <!-- Device Health -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-header">
                            <h3><i class="fas fa-heartbeat"></i> Health</h3>
                        </div>
                        <div class="health-metrics" id="healthMetrics">
                            <!-- Health metrics populated by JS -->
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <!-- Edit Device Modal -->
    <div class="modal" id="editDeviceModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Edit Device</h2>
                <button class="modal-close" data-modal="editDeviceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="modal-body" id="editDeviceForm">
                <div class="form-group">
                    <label for="editDeviceName">Device Name</label>
                    <input type="text" id="editDeviceName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="editDeviceDescription">Description</label>
                    <textarea id="editDeviceDescription" class="form-input" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editDeviceLocation">Location</label>
                        <input type="text" id="editDeviceLocation" class="form-input" placeholder="e.g., Field 1">
                    </div>
                    <div class="form-group">
                        <label for="editDeviceSampleRate">Sample Rate (sec)</label>
                        <input type="number" id="editDeviceSampleRate" class="form-input" min="1" value="60">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-modal="editDeviceModal">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-check"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Configuration Modal -->
    <div class="modal" id="editConfigModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2><i class="fas fa-sliders-h"></i> Edit Configuration</h2>
                <button class="modal-close" data-modal="editConfigModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label id="configLabel">Configuration</label>
                    <input type="text" id="configValue" class="form-input">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-modal="editConfigModal">Cancel</button>
                    <button type="button" class="btn-primary" id="saveConfigBtn">
                        <i class="fas fa-check"></i> Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Schedule Modal -->
    <div class="modal" id="addDeviceScheduleModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-calendar-plus"></i> Schedule Device Action</h2>
                <button class="modal-close" data-modal="addDeviceScheduleModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="modal-body" id="addDeviceScheduleForm">
                <div class="form-group">
                    <label for="scheduleAction">Action Type</label>
                    <select id="scheduleAction" class="form-input" required>
                        <option value="">Select action...</option>
                        <option value="calibrate">Calibrate Sensor</option>
                        <option value="reading">Take Reading</option>
                        <option value="alert">Send Alert</option>
                        <option value="custom">Custom Command</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="scheduleTime">Time</label>
                        <input type="time" id="scheduleTime" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="scheduleRecurrence">Recurrence</label>
                        <select id="scheduleRecurrence" class="form-input">
                            <option value="once">Once</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-modal="addDeviceScheduleModal">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-check"></i> Create Schedule
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirm Action Modal -->
    <div class="modal" id="confirmActionModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header danger">
                <h2><i class="fas fa-exclamation-circle"></i> Confirm Action</h2>
                <button class="modal-close" data-modal="confirmActionModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="confirm-message" id="confirmMessage"></p>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-modal="confirmActionModal">Cancel</button>
                    <button type="button" class="btn-danger" id="confirmActionBtn">
                        <i class="fas fa-check"></i> Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="{% static 'devices/js/device_detail.js' %}"></script>
</body>
</html>